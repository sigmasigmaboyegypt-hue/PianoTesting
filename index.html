<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Music Editor | CapCut Style</title>
<style>
body {
    margin: 0;
    font-family: 'Arial', sans-serif;
    background-color: #121212;
    color: #fff;
}

header {
    padding: 1rem;
    background-color: #1f1f1f;
    text-align: center;
    font-size: 1.5rem;
    font-weight: bold;
}

.container {
    display: flex;
    flex-direction: column;
    padding: 1rem;
}

.timeline {
    display: grid;
    grid-template-rows: repeat(6, 50px);
    grid-template-columns: repeat(16, 60px);
    gap: 2px;
    margin-bottom: 1rem;
}

.cell {
    background-color: #2b2b2b;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.1s;
}

.cell.active {
    background-color: #1db954;
}

.controls {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
}

button {
    padding: 0.5rem 1rem;
    background-color: #2b2b2b;
    border: none;
    color: #fff;
    cursor: pointer;
    border-radius: 4px;
}

button:hover {
    background-color: #3a3a3a;
}

.volume-control {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

input[type="range"] {
    width: 200px;
}

.timeline-labels {
    display: flex;
    justify-content: space-between;
    margin-bottom: 4px;
    font-size: 0.9rem;
}
</style>
</head>
<body>
<header>Mini Music Editor</header>
<div class="container">

    <div class="timeline-labels">
        <span>00:00</span>
        <span>00:16</span>
    </div>
    
    <div class="timeline" id="timeline"></div>

    <div class="controls">
        <button id="playBtn">Play</button>
        <button id="pauseBtn">Pause</button>
        <button id="stopBtn">Stop</button>
        <button id="loopBtn">Loop: Off</button>
    </div>

    <div class="volume-control">
        <span>Volume:</span>
        <input type="range" id="volumeSlider" min="0" max="100" value="80">
    </div>

</div>

<script>
const timeline = document.getElementById('timeline');
const playBtn = document.getElementById('playBtn');
const pauseBtn = document.getElementById('pauseBtn');
const stopBtn = document.getElementById('stopBtn');
const loopBtn = document.getElementById('loopBtn');
const volumeSlider = document.getElementById('volumeSlider');

const rows = 6;
const cols = 16;
let isPlaying = false;
let isLooping = false;
let currentStep = 0;
let playInterval;
let audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let volume = 0.8;

// Create timeline cells
const cells = [];
for(let r=0; r<rows; r++){
    cells[r] = [];
    for(let c=0; c<cols; c++){
        const cell = document.createElement('div');
        cell.classList.add('cell');
        cell.dataset.row = r;
        cell.dataset.col = c;
        cell.addEventListener('click', () => {
            cell.classList.toggle('active');
            playNote(r);
        });
        timeline.appendChild(cell);
        cells[r][c] = cell;
    }
}

// Play a note for a row
function playNote(row){
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'sine';
    osc.frequency.value = 220 + row*40;
    gain.gain.value = volume;
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.3);
}

// Play composition
function playStep(){
    for(let r=0; r<rows; r++){
        if(cells[r][currentStep].classList.contains('active')){
            playNote(r);
        }
    }
    currentStep++;
    if(currentStep >= cols){
        if(isLooping){
            currentStep = 0;
        } else {
            stopPlayback();
        }
    }
}

function startPlayback(){
    if(isPlaying) return;
    isPlaying = true;
    playInterval = setInterval(playStep, 300);
}

function pausePlayback(){
    clearInterval(playInterval);
    isPlaying = false;
}

function stopPlayback(){
    clearInterval(playInterval);
    isPlaying = false;
    currentStep = 0;
}

playBtn.addEventListener('click', startPlayback);
pauseBtn.addEventListener('click', pausePlayback);
stopBtn.addEventListener('click', stopPlayback);
loopBtn.addEventListener('click', () => {
    isLooping = !isLooping;
    loopBtn.textContent = `Loop: ${isLooping ? 'On':'Off'}`;
});

volumeSlider.addEventListener('input', () => {
    volume = volumeSlider.value / 100;
});
</script>
</body>
</html>
